<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>종수술 분류 검색 | 자동완성 · 질병코드 · 상단 토글</title>
  <style>
    :root{
      --bg:#f7f9ff; --card:#ffffff; --ink:#182340; --muted:#5b6b8c; --line:#e6ecf7;
      --brand:#3a64ff; --brand-soft:#e8eeff; --accent:#00c2a8; --radius:16px; --shadow:0 10px 30px rgba(15,25,55,.08);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:
      radial-gradient(900px 500px at 10% -10%, #ebf2ff 0%, transparent 60%),
      radial-gradient(900px 500px at 120% 0%, #f2fffb 0%, transparent 60%),
      var(--bg);
      color:var(--ink);font:14px/1.65 "Pretendard",ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Noto Sans KR,Arial;
      padding:34px;display:flex;align-items:flex-start;justify-content:center}
    .wrap{width:min(1200px,100%)}
    .title{margin:0 0 8px;font-weight:900;letter-spacing:.2px;font-size:clamp(22px,3.4vw,34px);text-align:center}
    .subtitle{margin:0 0 12px;color:var(--muted);text-align:center}

    /* 상단 토글 바 */
    .modebar{display:flex;gap:10px;align-items:center;justify-content:center;margin:8px 0 18px;flex-wrap:wrap}
    .modebar button{appearance:none;border:1px solid var(--line);padding:10px 16px;border-radius:999px;cursor:pointer;background:#fff;color:#2f3e6a;font-weight:800;min-width:150px}
    .modebar button.active{color:#fff;background:linear-gradient(180deg,var(--brand),#2e53d9);box-shadow:0 0 0 4px var(--brand-soft)}
    .mode-badge{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;font-weight:800;color:#2a47b8;background:var(--brand-soft);border:1px solid #d7e0ff}

    .panel{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px}

    .controls{display:grid;grid-template-columns:1fr auto;gap:12px;align-items:center}

    .searchbox{position:relative}
    .searchbox input{width:100%;height:56px;border:1px solid var(--line);border-radius:14px;padding:0 56px 0 18px;font-size:16px;outline:none;background:#fff;color:var(--ink);box-shadow:inset 0 1px 0 rgba(0,0,0,.02)}
    .searchbox input:focus{border-color:var(--brand);box-shadow:0 0 0 4px var(--brand-soft)}
    .search-btn{height:56px;padding:0 20px;border:0;border-radius:14px;font-weight:800;letter-spacing:.2px;cursor:pointer;background:linear-gradient(180deg,var(--brand),#2e53d9);color:#fff;box-shadow:0 8px 20px rgba(58,100,255,.25)}

    /* 자동완성 */
    .ac{position:absolute;left:0;right:0;top:60px;background:#fff;border:1px solid var(--line);border-radius:12px;box-shadow:var(--shadow);overflow:hidden;z-index:20;display:none}
    .ac.open{display:block}
    .ac ul{list-style:none;margin:0;padding:6px}
    .ac li{padding:10px 12px;border-radius:8px;cursor:pointer;display:flex;align-items:center;gap:10px}
    .ac li:hover,.ac li.active{background:#f6f9ff}
    .ac .code{font:12px/1.2 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;color:#2f5bff;background:#eef3ff;border:1px solid #d8e2ff;padding:2px 6px;border-radius:6px}

    .chips{margin-top:10px;display:flex;flex-wrap:wrap;gap:8px}
    .chip{background:var(--brand-soft);color:#2a47b8;border:1px solid #d7e0ff;padding:8px 12px;border-radius:999px;font-weight:700;cursor:pointer}

    .results{margin-top:16px;display:grid;grid-template-columns:1fr;gap:16px}
    /* 요약 배지 레이아웃을 안정적으로 */
    .summary-card{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px 14px;background:linear-gradient(180deg,#ffffff,#fbfdff);border:1px solid var(--line);border-radius:var(--radius);padding:14px;align-items:stretch}
    .pill{display:flex;flex-direction:column;justify-content:center;align-items:flex-start;gap:6px;background:#fff;border:1px solid var(--line);padding:10px 14px;border-radius:12px;font-weight:800;min-height:64px;word-break:keep-all;overflow-wrap:anywhere}
    .pill b{font-size:12px;color:#60709a;letter-spacing:.2px}

    .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    @media (max-width:860px){.grid{grid-template-columns:1fr}}
    @media (max-width:480px){.summary-card{grid-template-columns:1fr}.pill{min-height:56px}}

    .card{background:#fff;border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden}
    .card h3{margin:0;padding:14px 16px;font-size:16px;letter-spacing:.3px;border-bottom:1px solid var(--line)}
    .card h3 .sub{color:var(--muted);font-weight:600;margin-left:6px}

    table{width:100%;border-collapse:collapse;font-size:14px}
    thead th{text-align:center;background:#f7faff;color:#3a4a7a;border-bottom:1px solid var(--line);padding:10px}
    tbody td{padding:12px 10px;border-bottom:1px dashed var(--line)}
    tbody tr:hover{background:#fbfcff}
    .center{text-align:center}
    .right{text-align:right}

    .note{color:var(--muted);font-size:12px;margin-top:10px}
  </style>
</head>
<body>
  <main class="wrap">
    <h1 class="title"><span id="titleText">종수술 분류 검색</span></h1>
    <p class="subtitle">수술명을 검색하면 <b>손해보험(공통)</b>·<b>생명보험(회사별)</b>의 <b>종</b>과 <b>질병코드</b>를 함께 보여줍니다.</p>
    <div class="modebar" role="tablist" aria-label="보기 전환">
      <button id="btnModeDisease" class="active" data-kind="질병종수술비" role="tab" aria-selected="true">질병종수술비</button>
      <button id="btnModeAccident" data-kind="상해종수술비" role="tab" aria-selected="false">상해종수술비</button>
      <span id="modeBadge" class="mode-badge">현재 보기: 질병종수술비</span>
    </div>

    <section class="panel">
      <div class="controls">
        <div class="searchbox">
          <input id="q" type="text" placeholder="예: 대장용종, 폴립절제술, EMR, ESD" aria-label="수술명 검색" />
          <div class="ac" id="ac"><ul id="acList"></ul></div>
        </div>
        <button id="searchBtn" class="search-btn">검색</button>
      </div>

      <div class="chips" aria-label="빠른검색">
        <button class="chip" data-k="대장용종">대장용종</button>
        <button class="chip" data-k="맹장수술">맹장수술</button>
        <button class="chip" data-k="담낭절제술">담낭절제술</button>
        <button class="chip" data-k="혈전제거술">혈전제거술</button>
        <button class="chip" data-k="갑상선절제">갑상선절제</button>
      </div>

      <div id="results" class="results" aria-live="polite" aria-busy="false"></div>
      <p class="note">※ 본 결과는 <b>예시 데이터</b>이며, 실제 분류/지급기준은 각 보험사의 약관·분류표를 따릅니다. 질병코드는 KCD/ICD-10 기준 예시 표기입니다.</p>
    </section>
  </main>

  <script>
    // ===== 예시 데이터 =====
    const DB = [
      { canonical:"대장용종", alias:["대장 용종","용종","폴립","폴리펙토미","용종절제","대장 폴립","폴립절제술","폴립 절제"],
        code:[{system:"KCD/ICD-10",value:"K63.5",name:"대장용종"},{system:"KCD/ICD-10",value:"K62.1",name:"직장용종"}],
        loss_disease:{tier:3,note:"내시경 용종절제 포함(예시)"}, loss_accident:null,
        life:[
          {company:"삼성생명",tier:3,basis:"내시경 경도(예시)"},
          {company:"한화생명",tier:2,basis:"소용종 CSP 등 저종(예시)"},
          {company:"교보생명",tier:3,basis:"EMR 기준(예시)"},
          {company:"농협생명",tier:2,basis:"경미 시술 저종(예시)"},
          {company:"신한라이프",tier:4,basis:"ESD/복잡 시 상향(예시)"}
        ],
        procs:[
          {name:"CSP (Cold Snare Polypectomy)", aka:"차가운 스네어 절제", loss_tier:"주로 3종", life_tier:"2~3종", note:"<10mm 소폴립"},
          {name:"HSP (Hot Snare Polypectomy)", aka:"고주파 스네어 절제", loss_tier:"3~4종", life_tier:"3~4종", note:"10mm↑ 또는 위치/혈관 주의"},
          {name:"EMR (점막절제술)", aka:"Endoscopic Mucosal Resection", loss_tier:"3~4종", life_tier:"3~4종", note:"piecemeal 시 상향 가능"},
          {name:"ESD (점막하 박리술)", aka:"Endoscopic Submucosal Dissection", loss_tier:"4~5종", life_tier:"4~5종", note:"고난도/장시간"}
        ]
      },
      { canonical:"맹장수술", alias:["충수절제","충수염 수술","appendectomy","맹장 수술"],
        code:[{system:"KCD/ICD-10",value:"K35",name:"급성 충수염"}],
        loss_disease:{tier:2,note:"복강경 포함(예시)"}, loss_accident:null,
        life:[{company:"삼성생명",tier:2,basis:"복강경 동일(예시)"},{company:"한화생명",tier:3,basis:"천공/농양 상향(예시)"}] },
      { canonical:"담낭절제술", alias:["담낭 절제","cholecystectomy","담석 수술"],
        code:[{system:"KCD/ICD-10",value:"K80",name:"담석증(예시)"}],
        loss_disease:{tier:3,note:"복강경 기준(예시)"}, loss_accident:null,
        life:[{company:"삼성생명",tier:3,basis:"복강경 기준(예시)"},{company:"교보생명",tier:4,basis:"개복 상향(예시)"}] },
      { canonical:"혈전제거술", alias:["thrombectomy","혈전 용해술","혈관내 치료"],
        code:[{system:"KCD/ICD-10",value:"I74",name:"혈전색전증"},{system:"KCD/ICD-10",value:"I63",name:"뇌경색(관련)"}],
        loss_disease:{tier:5,note:"혈관계 고난도 일부(예시)"}, loss_accident:{tier:5,note:"외상성 혈관 손상 시(예시)"},
        life:[{company:"삼성생명",tier:5,basis:"혈관내 중재(예시)"},{company:"한화생명",tier:6,basis:"뇌/대혈관 상향(예시)"}] },
      { canonical:"갑상선절제", alias:["갑상선 엽절제","갑상선 전절제","thyroidectomy"],
        code:[{system:"KCD/ICD-10",value:"E04",name:"갑상선 양성(예시)"},{system:"KCD/ICD-10",value:"C73",name:"갑상선암(관련)"}],
        loss_disease:{tier:4,note:"엽절제 기준(예시)"}, loss_accident:null,
        life:[{company:"교보생명",tier:4,basis:"엽절제(예시)"},{company:"신한라이프",tier:5,basis:"전절제 상향(예시)"}] }
    ];

    // alias → canonical
    const ALIAS = (()=>{ const m=new Map(); for(const r of DB){ m.set(r.canonical.replace(/\s+/g,''), r.canonical); for(const a of r.alias){ m.set(a.replace(/\s+/g,''), r.canonical); } } return m; })();

    const elQ=document.getElementById('q');
    const elBtn=document.getElementById('searchBtn');
    const elRes=document.getElementById('results');
    const ac=document.getElementById('ac');
    const acList=document.getElementById('acList');

    const state={ kind:'질병종수술비' }; // 또는 '상해종수술비'

    function suggest(q){
      const key=q.replace(/\s+/g,''); if(!key) return [];
      const seen=new Set(); const out=[];
      for(const row of DB){ for(const n of [row.canonical,...row.alias]){ const norm=n.replace(/\s+/g,''); if(norm.includes(key) && !seen.has(row.canonical)){ out.push(row); seen.add(row.canonical); break; } } }
      return out.slice(0,8);
    }
    function openAC(items){ if(!items.length){ ac.classList.remove('open'); return; } acList.innerHTML=items.map((r,i)=>{ const ct=r.code?.[0]?.value||''; return `<li data-i="${i}"><strong>${r.canonical}</strong> ${ct?`<span class=code>${ct}</span>`:''}</li>` }).join(''); ac.classList.add('open'); }
    function closeAC(){ ac.classList.remove('open'); }

    function pill(label, value, hint=""){ return `<span class=\"pill\"><b>${label}</b> ${value}${hint?` <span style=\"color:#60709a\">${hint}</span>`:""}</span>`; }

    function renderResult(canonical){
      const row=DB.find(r=>r.canonical===canonical);
      if(!row){ elRes.innerHTML='<div class="card" style="padding:20px;text-align:center;color:#51608a">검색 결과가 없습니다. 다른 표현으로 시도해 주세요.</div>'; return; }
      const loss = state.kind==='질병종수술비' ? row.loss_disease : row.loss_accident;
      const life = row.life||[];

      const top = `
        <div class="summary-card">
          ${pill('보기', state.kind)}
          ${pill('손해보험', loss? `${loss.tier}종`:'—', loss?.note||'')}
          ${pill('생명보험', life.length? `${Math.min(...life.map(x=>x.tier))}~${Math.max(...life.map(x=>x.tier))}종`:'—', '회사별 상이')}
          ${pill('수술명', row.canonical)}
        </div>`;

      const codeHtml = (row.code&&row.code.length) ? row.code.map(c=> pill(c.system, `<b>${c.value}</b>`, c.name||'')).join(' ') : pill('코드','없음');

      const left=`<div class="card"><h3>손해보험 <span class="sub">(${state.kind} 기준 · 예시)</span></h3><table><thead><tr><th class="center">분류</th><th>근거/비고</th></tr></thead><tbody>${loss?`<tr><td class="center"><b>${loss.tier}종</b></td><td>${loss.note||''}</td></tr>`:`<tr><td class="center" colspan="2">자료 없음</td></tr>`}</tbody></table></div>`;

      const right=`<div class="card"><h3>생명보험 <span class="sub">(회사별 · 예시)</span></h3><table><thead><tr><th>회사</th><th class="center">종</th><th>근거/비고</th></tr></thead><tbody>${life.length? life.map(r=>`<tr><td>${r.company}</td><td class="center"><b>${r.tier}종</b></td><td>${r.basis||''}</td></tr>`).join(''):`<tr><td class="center" colspan="3">자료 없음</td></tr>`}</tbody></table></div>`;

      const detail = row.procs && row.procs.length ? `
        <div class="card">
          <h3>세부 시술( ${row.canonical} ) <span class="sub">— 예시</span></h3>
          <table>
            <thead><tr><th>시술명</th><th>설명/키워드</th><th class="center">손해(질병) 종</th><th class="center">생명 종</th></tr></thead>
            <tbody>
              ${row.procs.map(p=>`<tr><td><b>${p.name}</b><div style="color:#60709a">${p.aka||''}</div></td><td>${p.note||''}</td><td class="center">${p.loss_tier||'—'}</td><td class="center">${p.life_tier||'—'}</td></tr>`).join('')}
            </tbody>
          </table>
        </div>` : '';

      elRes.innerHTML = `${top}<div style="display:flex;flex-wrap:wrap;gap:8px;margin:10px 0 0">${codeHtml}</div><div class="grid">${left}${right}</div>${detail}`;
    }

    function doSearch(){ const raw=elQ.value.trim(); if(!raw){ elRes.innerHTML=''; return; } const norm=raw.replace(/\s+/g,''); const canonical=ALIAS.get(norm)||raw; renderResult(canonical); closeAC(); }

    function updateHeader(){ const title=document.getElementById('titleText'); const badge=document.getElementById('modeBadge'); if(title&&badge){ title.textContent = state.kind==='질병종수술비' ? '질병 종수술 분류표' : '상해 종수술 분류표'; badge.textContent = `현재 보기: ${state.kind}`; }
      const mD=document.getElementById('btnModeDisease'); const mA=document.getElementById('btnModeAccident');
      if(mD&&mA){ mD.classList.toggle('active', state.kind==='질병종수술비'); mA.classList.toggle('active', state.kind==='상해종수술비'); }
    }

    // 이벤트
    elQ.addEventListener('input', ()=>{ openAC(suggest(elQ.value)); });
    elQ.addEventListener('focus', ()=>{ openAC(suggest(elQ.value)); });
    elQ.addEventListener('blur', ()=>{ setTimeout(closeAC,150); });
    acList.addEventListener('click', (e)=>{ const li=e.target.closest('li'); if(!li) return; const idx=Number(li.dataset.i); const row=suggest(elQ.value)[idx]; if(row){ elQ.value=row.canonical; doSearch(); }});

    document.querySelectorAll('.chip').forEach(ch=> ch.addEventListener('click', ()=>{ elQ.value=ch.dataset.k; doSearch(); }));
    document.getElementById('searchBtn').addEventListener('click', doSearch);
    elQ.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ doSearch(); }});

    // 상단 토글
    document.getElementById('btnModeDisease').addEventListener('click', ()=>{ state.kind='질병종수술비'; updateHeader(); if(elQ.value.trim()) doSearch(); });
    document.getElementById('btnModeAccident').addEventListener('click', ()=>{ state.kind='상해종수술비'; updateHeader(); if(elQ.value.trim()) doSearch(); });

    // 초기 세팅
    updateHeader();
  </script>
</body>
</html>
