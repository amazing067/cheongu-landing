<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>종수술 분류표 | 청구닷컴</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;800;900&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#f7f9fc; --card:#ffffff; --line:#e6ebf2; --txt:#0f172a; --mut:#64748b;
    --ind:#6366f1; --sky:#0ea5e9; --emer:#10b981; --vio:#7c3aed; --amber:#f59e0b;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);font-family:Pretendard,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:var(--txt)}
  /* 중앙 레이아웃 */
  .wrap{max-width:980px;margin:28px auto;padding:0 18px}
  .panel{background:var(--card);border:1px solid var(--line);border-radius:14px;box-shadow:0 6px 22px rgba(2,6,23,.04)}
  .head{display:flex;flex-wrap:wrap;align-items:center;justify-content:center;gap:12px;margin-bottom:14px}
  .title{font-weight:900;font-size:24px;letter-spacing:-.01em}
  .subtitle{font-size:12px;color:#475569}

  /* 탭 */
  .tabs{display:flex;gap:8px;justify-content:center;margin-top:8px}
  .tab{border:1px solid var(--line);background:#fff;border-radius:999px;padding:7px 14px;font-weight:800;font-size:13px;cursor:pointer}
  .tab.active{background:linear-gradient(135deg,var(--vio),var(--ind));color:#fff;border-color:transparent}

  /* 검색 박스 */
  .search-wrap{padding:14px}
  .search-grid{display:grid;grid-template-columns:1fr auto;gap:8px;align-items:center}
  .search{height:42px;border:1px solid var(--line);border-radius:12px;padding:0 14px;width:100%;font-size:15px}
  .btn{height:42px;border-radius:12px;border:0;background:linear-gradient(135deg,var(--sky),#3b82f6);color:#fff;font-weight:900;padding:0 16px}
  .note{font-size:12px;color:#475569;margin-top:6px}

  /* 표 */
  .card{margin-top:14px}
  table{width:100%;border-collapse:separate;border-spacing:0}
  th,td{padding:12px 14px;border-bottom:1px solid var(--line);vertical-align:top}
  th{background:#f9fbff;color:#334155;font-size:12px;text-align:left}
  .k{font-weight:900}
  .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px}
  .chip{border:1px solid var(--line);border-radius:999px;padding:6px 10px;background:#fff;font-size:12px}
  .pill{display:inline-flex;align-items:center;gap:6px;border-radius:999px;padding:6px 10px;color:#fff;font-weight:900;letter-spacing:.01em}
  .pill-loss{background:linear-gradient(135deg,var(--ind),#3b82f6)}
  .pill-life{background:linear-gradient(135deg,var(--emer),#059669)}
  .mut{color:var(--mut);font-size:12px}
  .empty{padding:22px;text-align:center;color:#475569}

  mark{background:rgba(99,102,241,.18)}
</style>
</head>
<body>
  <div class="wrap">
    <div class="head">
      <div class="title">종수술 분류표</div>
      <div class="subtitle">검색 → 질병·수술명 / 키워드 / KCD 코드 • 손해/생명 스케일 동시 표기</div>
    </div>

    <!-- 탭: 질병수술비 / 상해수술비 -->
    <div class="tabs">
      <button class="tab active" data-type="질병">질병수술비</button>
      <button class="tab" data-type="상해">상해수술비</button>
    </div>

    <!-- 검색 -->
    <div class="panel search-wrap">
      <div class="search-grid">
        <input id="q" class="search" type="search" placeholder="예: 대장용종, 담낭절제, K63.5, 폴립">
        <button id="btnSearch" class="btn">검색</button>
      </div>
      <div class="note">※ 본 표는 내부 참고용 도구입니다. 실제 청구/지급은 <b>약관·심사</b> 기준을 따릅니다.</div>
    </div>

    <!-- 결과 표 -->
    <div class="panel card">
      <table>
        <thead>
          <tr>
            <th style="width:26%">병명/시술명</th>
            <th style="width:19%">코드/동의어</th>
            <th style="width:20%">손해보험 분류</th>
            <th style="width:20%">생명보험 분류</th>
            <th>비고/근거</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
      <div class="empty" id="empty" style="display:none">검색 결과가 없습니다.</div>
    </div>

    <p class="note" style="margin:12px 4px">
      • 스케일 예: <b>1-3, 1-5, 1-7, 1-8</b> 등 회사/상품별 상이 → 값만 업데이트하면 그대로 표시됩니다.<br>
      • 회사별로 다른 기준이 있는 경우 <code>overrides</code>에 개별 설정(예: <code>loss.overrides["OO손해"]={scale:"1-5",grade:2}</code>).
    </p>
  </div>

<script>
/* =========================
   데이터 스키마 (예시)
   =========================
   {
     id: "poly_colon",
     type: "질병" | "상해",
     name: "대장용종(내시경 용종절제술)",
     aliases: ["대장폴립","K63.5",...],
     codes: { KCD:["K63.5"], ETC:[] },
     loss: { scale:"1-5", grade:null, overrides:{} }, // 손해보험
     life: { scale:"1-8", grade:null, overrides:{} }, // 생명보험 (임의 스케일 지원)
     note: "약관/근거 메모"
   }
*/

// 샘플 데이터 (모두 예시! 실제 약관 기준으로 교체)
const DATA = [
  // 질병
  {
    id:"poly_colon",
    type:"질병",
    name:"대장용종(내시경 용종절제술)",
    aliases:["대장폴립","폴립절제","용종절제","내시경 용종절제","K63.5"],
    codes:{KCD:["K63.5"],ETC:[]},
    loss:{scale:"1-5",grade:2,overrides:{}},
    life:{scale:"1-8",grade:2,overrides:{}},
    note:"예시. 실제 회사/시기별 상이."
  },
  {
    id:"appy",
    type:"질병",
    name:"충수절제술(맹장수술)",
    aliases:["맹장염","충수염","appendectomy","K35"],
    codes:{KCD:["K35"],ETC:[]},
    loss:{scale:"1-5",grade:3,overrides:{}},
    life:{scale:"1-7",grade:3,overrides:{}},
    note:"예시값."
  },
  {
    id:"chole",
    type:"질병",
    name:"담낭절제술(복강경)",
    aliases:["담석","담낭염","담낭절제","cholecystectomy","K80","K81"],
    codes:{KCD:["K80","K81"],ETC:[]},
    loss:{scale:"1-5",grade:3,overrides:{}},
    life:{scale:"1-8",grade:3,overrides:{}},
    note:"예시값."
  },

  // 상해
  {
    id:"fx_wrist",
    type:"상해",
    name:"원위요골 골절 정복술(핀/플레이트)",
    aliases:["손목골절","요골골절","정복술","plate","pin"],
    codes:{KCD:["S52.5"],ETC:[]},
    loss:{scale:"1-5",grade:4,overrides:{}},
    life:{scale:"1-5",grade:3,overrides:{}},
    note:"예시: 상해수술비 분류 샘플."
  },
  {
    id:"acl",
    type:"상해",
    name:"무릎 전방십자인대 재건술",
    aliases:["십자인대","ACL","재건술"],
    codes:{KCD:["S83.5"],ETC:[]},
    loss:{scale:"1-5",grade:5,overrides:{}},
    life:{scale:"1-7",grade:4,overrides:{}},
    note:"예시."
  },
];

const $ = (s,el=document)=>el.querySelector(s);
const $$ = (s,el=document)=>Array.from(el.querySelectorAll(s));
const state = { q:"", type:"질병" };

function escapeHTML(s){ return String(s).replace(/[&<>"']/g,c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c])); }
function hi(text,q){
  if(!q) return escapeHTML(text);
  const re = new RegExp('('+q.replace(/[.*+?^${}()|[\\]\\\\]/g,'\\$&')+')','ig');
  return escapeHTML(text).replace(re,'<mark>$1</mark>');
}
function matchScore(item, q){
  if(!q) return 1;
  const hay = [item.name,...(item.aliases||[]),(item.codes?.KCD||[]).join(' ')].join(' ').toLowerCase();
  return hay.includes(q.toLowerCase()) ? 1 : 0;
}

function gradeText(side){
  if(!side) return '스케일 미정';
  const sc = side.scale || '스케일 미정';
  const g  = (side.grade ?? '–');
  return `${sc} · ${g}종`;
}
function overrideList(ov){
  if(!ov || !Object.keys(ov).length) return `<div class="mut" style="margin-top:6px">회사별 예외 없음</div>`;
  return `<div class="mut" style="margin-top:6px">회사별 예외:</div>
          <ul class="mut" style="margin:4px 0 0 14px">
            ${Object.entries(ov).map(([k,v])=>`<li>${escapeHTML(k)} → ${escapeHTML(v.scale||'?')} · ${escapeHTML(v.grade ?? '–')}종</li>`).join('')}
          </ul>`;
}

function rowHTML(it, q){
  const loss = it.loss||{}, life = it.life||{};
  const aliases = [...(it.aliases||[])].slice(0,8).map(a=>`<span class="chip">${hi(a,q)}</span>`).join(' ');
  const kcds = (it.codes?.KCD||[]).map(c=>`<span class="chip">${hi(c,q)}</span>`).join(' ') || '<span class="chip">-</span>';
  return `
  <tr>
    <td><div class="k">${hi(it.name,q)}</div><div class="chips">${aliases}</div></td>
    <td><div class="chips">${kcds}</div></td>
    <td>
      <div class="pill pill-loss">${gradeText(loss)}</div>
      ${overrideList(loss.overrides)}
    </td>
    <td>
      <div class="pill pill-life">${gradeText(life)}</div>
      ${overrideList(life.overrides)}
    </td>
    <td><div class="mut">${escapeHTML(it.note||'')}</div></td>
  </tr>`;
}

function render(){
  const q = state.q.trim();
  const list = DATA.filter(x=>x.type===state.type)
                   .map(x=>({x,score:matchScore(x,q)}))
                   .filter(o=>o.score>0)
                   .map(o=>o.x);

  $("#tbody").innerHTML = list.map(it=>rowHTML(it,q)).join('');
  $("#empty").style.display = list.length ? 'none' : '';
}

/* 이벤트 */
$("#btnSearch").addEventListener('click', ()=>{ state.q = $("#q").value; render(); });
$("#q").addEventListener('keydown', e=>{ if(e.key==='Enter'){ state.q = e.target.value; render(); }});
document.addEventListener('keydown', e=>{ if(e.key==='/'){ e.preventDefault(); $("#q").focus(); } });

$$('.tab').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    $$('.tab').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    state.type = btn.dataset.type;  // '질병' or '상해'
    render();
  });
});

// 초기 렌더
render();
</script>
</body>
</html>
