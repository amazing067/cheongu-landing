<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>질병 종수술 분류표 · 결과만 표시</title>
<style>
:root{
  --bg:#f7f9ff; --card:#ffffff; --ink:#182340; --muted:#5b6b8c; --line:#e6ecf7;
  --brand:#3a64ff; --brand2:#2e53d9; --accent:#00c2a8;
  --radius:16px; --shadow:0 10px 30px rgba(15,25,55,.08);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;background:
    radial-gradient(900px 500px at 10% -10%, #ebf2ff 0%, transparent 60%),
    radial-gradient(900px 500px at 120% 0%, #f2fffb 0%, transparent 60%),
    var(--bg);
  color:var(--ink);
  font:14px/1.65 "Pretendard",ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Noto Sans KR,Arial;
  padding:28px;display:flex;justify-content:center;align-items:flex-start
}
.wrap{width:min(1000px,100%)}
.title{margin:0 0 8px;font-weight:900;font-size:clamp(22px,3.4vw,34px);text-align:center}
.subtitle{margin:0 0 16px;color:var(--muted);text-align:center}

.panel{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px}
.controls{display:grid;grid-template-columns:1fr auto;gap:10px;align-items:center}
.searchbox{position:relative}
.searchbox input{width:100%;height:56px;border:1px solid var(--line);border-radius:14px;padding:0 56px 0 16px;font-size:16px;background:#fff}
.searchbox input:focus{border-color:var(--brand);box-shadow:0 0 0 4px #e8eeff;outline:0}
.btn{height:56px;padding:0 18px;border:0;border-radius:14px;font-weight:900;cursor:pointer;color:#fff;
     background:linear-gradient(135deg,var(--brand),var(--brand2));box-shadow:0 8px 20px rgba(58,100,255,.25)}

.ac{position:absolute;left:0;right:0;top:60px;background:#fff;border:1px solid var(--line);border-radius:12px;box-shadow:var(--shadow);overflow:hidden;z-index:20;display:none;max-height:360px;overflow:auto}
.ac.open{display:block}
.ac ul{list-style:none;margin:0;padding:6px}
.ac li{padding:10px 12px;border-radius:8px;cursor:pointer;display:flex;flex-direction:column;gap:4px}
.ac li:hover,.ac li.active{background:#f6f9ff}
.ac .name{font-weight:800}
.ac .desc{font-size:12px;color:#60709a}

.grid{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-top:14px}
@media(max-width:820px){.grid{grid-template-columns:1fr}}
.card{background:#fff;border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden}
.card .hd{
  padding:14px 16px;border-bottom:1px solid var(--line);font-size:16px;font-weight:900;text-align:center;
  background:linear-gradient(135deg,var(--accent),var(--brand));color:#fff
}
.result{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:8px;padding:26px 16px 30px}
.big{font-size:44px;font-weight:900;letter-spacing:.5px}
.caption{color:#60709a}
.namebar{margin-top:10px;text-align:center;font-weight:800}
.muted{color:#60709a}
.note{margin-top:8px;color:#60709a;font-size:12px;text-align:center}
.bad{opacity:.5}
</style>
</head>
<body>
<main class="wrap">
  <h1 class="title">질병 종수술 분류표</h1>
  <p class="subtitle">검색 → 자동완성에서 정확한 항목 선택 → <b>등급 결과만</b> 표시</p>

  <section class="panel">
    <div class="controls">
      <div class="searchbox">
        <input id="q" type="text" placeholder="예: 대장용종절제술, 위용종, 담낭절제술, 갑상선 전절제…" aria-label="수술명 검색"/>
        <div class="ac" id="ac"><ul id="acList"></ul></div>
      </div>
      <button id="btn" class="btn">검색</button>
    </div>

    <div id="picked" class="namebar muted">검색어를 입력해 주세요.</div>

    <div class="grid" style="margin-top:10px">
      <div class="card">
        <div class="hd">1~3종 수술비</div>
        <div class="result" id="rA">
          <div class="big bad">—</div>
          <div class="caption">해당 등급 없음</div>
        </div>
      </div>
      <div class="card">
        <div class="hd">1~5종 수술비</div>
        <div class="result" id="rB">
          <div class="big bad">—</div>
          <div class="caption">해당 등급 없음</div>
        </div>
      </div>
    </div>

    <p class="note">※ 자동완성 항목은 <b>수술명 + (괄호 설명)</b> 단위로 정확히 매칭됩니다.</p>
  </section>
</main>

<script>
/* 1) 여기에 “전체 원문” 붙여넣기 (현재는 샘플 몇 줄) */
const RAW_DATA = String.raw`
12(내시경적) 위용종제거술
12(내시경적) 위출혈지혈술
12결장용종절제술
23담낭절제술(개복 또는 복강경)
12충수절제술
23갑상선 전절제술
21수정체 초음파유화흡입술(백내장)
`;

/* 2) 파서: [앞자리=3종키, 뒷자리=5종키, (괄호)설명, 수술명] */
function normalize(s){ return s.replace(/\s+/g,' ').trim(); }
function parseRaw(text){
  const out=[]; const re=/^\s*([0-9X])([0-9X])\s*(?:\(([^)]+)\))?\s*(.+?)\s*$/;
  const lines=text.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
  for(const line of lines){
    const m=line.match(re); if(!m) continue;
    const a=m[1], b=m[2], desc=m[3]?normalize(m[3]):"", name=normalize(m[4]);
    const aTier=(a>='1' && a<='3')?Number(a):null;
    const bTier=(b>='1' && b<='5')?Number(b):null;
    const label = desc ? `${name} (${desc})` : name;
    out.push({name, desc, label, aTier, bTier, raw:line});
  }
  return out;
}
let DB = parseRaw(RAW_DATA);

/* 3) 자동완성(연관 검색) */
const elQ = document.getElementById('q');
const elBtn = document.getElementById('btn');
const elAC = document.getElementById('ac');
const elACList = document.getElementById('acList');
const elPicked = document.getElementById('picked');
const elRA = document.getElementById('rA');
const elRB = document.getElementById('rB');

function keyNoSpace(s){ return (s||'').replace(/\s+/g,'').trim(); }
function suggest(q){
  const k = keyNoSpace(q);
  if(!k) return [];
  const seen = new Set();
  const arr=[];
  for(const r of DB){
    const nk = keyNoSpace(r.name);
    if(nk.includes(k) && !seen.has(r.label)){
      arr.push(r); seen.add(r.label);
      if(arr.length>=30) break;
    }
  }
  return arr;
}
function openAC(items){
  if(!items.length){ elAC.classList.remove('open'); elACList.innerHTML=''; return; }
  elACList.innerHTML = items.map((r,i)=>`
    <li data-i="${i}">
      <span class="name">${r.name}</span>
      ${r.desc?`<span class="desc">(${r.desc})</span>`:""}
    </li>`).join('');
  elAC.classList.add('open');
}
function closeAC(){ elAC.classList.remove('open'); }

/* 4) 결과 렌더(선택 즉시 등급만 표시) */
function setResult(aTier, bTier, label){
  elPicked.classList.remove('muted');
  elPicked.textContent = label;

  elRA.innerHTML = aTier!=null
    ? `<div class="big">${aTier}종</div><div class="caption">선택 항목의 3종표 결과</div>`
    : `<div class="big bad">—</div><div class="caption">해당 등급 없음</div>`;

  elRB.innerHTML = bTier!=null
    ? `<div class="big">${bTier}종</div><div class="caption">선택 항목의 5종표 결과</div>`
    : `<div class="big bad">—</div><div class="caption">해당 등급 없음</div>`;
}

function pickByLabel(label){
  // 동일 라벨이 여러 개인 경우(매우 드묾) 첫 항목 사용
  const r = DB.find(x=>x.label===label) || DB.find(x=>x.name===label) || null;
  if(!r){ elPicked.classList.add('muted'); elPicked.textContent='검색 결과가 없습니다.'; return; }
  setResult(r.aTier, r.bTier, r.label);
  closeAC();
}

/* 5) 이벤트 */
elQ.addEventListener('input', ()=> openAC(suggest(elQ.value)));
elQ.addEventListener('focus', ()=> openAC(suggest(elQ.value)));
elQ.addEventListener('blur', ()=> setTimeout(closeAC, 150));
elACList.addEventListener('click', (e)=>{
  const li = e.target.closest('li'); if(!li) return;
  const items = suggest(elQ.value);
  const r = items[Number(li.dataset.i)];
  if(r){ elQ.value = r.label; pickByLabel(r.label); }
});
elBtn.addEventListener('click', ()=> pickByLabel(elQ.value.trim()));
elQ.addEventListener('keydown', (e)=>{ if(e.key==='Enter') pickByLabel(elQ.value.trim()); });

/* 초기 메시지 */
elPicked.textContent = '검색어를 입력해 주세요.';
</script>
</body>
</html>
