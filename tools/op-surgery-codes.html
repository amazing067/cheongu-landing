<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>질병 종수술 분류표 | 1~3종 · 1~5종 그룹 출력</title>
  <style>
    :root{
      --bg:#f7f9ff; --card:#ffffff; --ink:#182340; --muted:#5b6b8c; --line:#e6ecf7;
      --brand:#3a64ff; --brand-soft:#e8eeff; --radius:16px; --shadow:0 10px 30px rgba(15,25,55,.08);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:
        radial-gradient(900px 500px at 10% -10%, #ebf2ff 0%, transparent 60%),
        radial-gradient(900px 500px at 120% 0%, #f2fffb 0%, transparent 60%),
        var(--bg);
      color:var(--ink);font:14px/1.65 "Pretendard",ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Noto Sans KR,Arial;
      padding:34px;display:flex;align-items:flex-start;justify-content:center
    }
    .wrap{width:min(1200px,100%)}
    .title{margin:0 0 8px;font-weight:900;letter-spacing:.2px;font-size:clamp(22px,3.4vw,34px);text-align:center}
    .subtitle{margin:0 0 12px;color:var(--muted);text-align:center}

    .panel{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px}
    .controls{display:grid;grid-template-columns:1fr auto;gap:12px;align-items:center}
    .searchbox{position:relative}
    .searchbox input{width:100%;height:56px;border:1px solid var(--line);border-radius:14px;padding:0 56px 0 18px;font-size:16px;outline:none;background:#fff;color:var(--ink);box-shadow:inset 0 1px 0 rgba(0,0,0,.02)}
    .searchbox input:focus{border-color:var(--brand);box-shadow:0 0 0 4px var(--brand-soft)}
    .search-btn{height:56px;padding:0 20px;border:0;border-radius:14px;font-weight:800;letter-spacing:.2px;cursor:pointer;background:linear-gradient(180deg,var(--brand),#2e53d9);color:#fff;box-shadow:0 8px 20px rgba(58,100,255,.25)}

    .ac{position:absolute;left:0;right:0;top:60px;background:#fff;border:1px solid var(--line);border-radius:12px;box-shadow:var(--shadow);overflow:hidden;z-index:20;display:none}
    .ac.open{display:block}
    .ac ul{list-style:none;margin:0;padding:6px}
    .ac li{padding:10px 12px;border-radius:8px;cursor:pointer;display:flex;align-items:center;gap:10px}
    .ac li:hover,.ac li.active{background:#f6f9ff}
    .ac .code{font:12px/1.2 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono";color:#2f5bff;background:#eef3ff;border:1px solid #d8e2ff;padding:2px 6px;border-radius:6px}

    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px;margin-top:16px}
    .card{background:#fff;border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden}
    .card h3{margin:0;padding:14px 16px;font-size:16px;letter-spacing:.3px;border-bottom:1px solid var(--line)}
    .tier{padding:8px 14px;border-top:1px dashed var(--line)}
    .tier h4{margin:6px 0 6px;font-size:14px}
    ul.list{margin:0;padding:0 0 8px 18px}
    ul.list li{margin:2px 0 2px;line-height:1.5}
    .muted{color:var(--muted)}
    .raw-toggle{margin:10px 0 0;text-align:right}
    .raw-area{width:100%;height:160px;border:1px solid var(--line);border-radius:10px;padding:10px;font-family:ui-monospace,Consolas,Menlo,monospace;display:none}
    .raw-area.show{display:block}
    .chips{margin-top:10px;display:flex;flex-wrap:wrap;gap:8px}
    .chip{background:var(--brand-soft);color:#2a47b8;border:1px solid #d7e0ff;padding:8px 12px;border-radius:999px;font-weight:700;cursor:pointer}
    .empty{padding:16px;color:var(--muted)}
  </style>
</head>
<body>
  <main class="wrap">
    <h1 class="title">질병 종수술 분류표</h1>
    <p class="subtitle">검색 결과를 <b>1~3종 수술비</b>, <b>1~5종 수술비</b> 블록으로만 나눠서 종별 리스트로 보여줍니다.</p>

    <section class="panel">
      <div class="controls">
        <div class="searchbox">
          <input id="q" type="text" placeholder="예: 위용종, 용종절제, 맹장, 담낭절제, 혈전제거" aria-label="수술명 검색" />
          <div class="ac" id="ac"><ul id="acList"></ul></div>
        </div>
        <button id="searchBtn" class="search-btn">검색</button>
      </div>

      <div class="chips" aria-label="빠른검색">
        <button class="chip" data-k="용종">용종</button>
        <button class="chip" data-k="담낭">담낭</button>
        <button class="chip" data-k="갑상선">갑상선</button>
        <button class="chip" data-k="혈전">혈전</button>
        <button class="chip" data-k="자궁">자궁</button>
      </div>

      <div class="raw-toggle">
        <button id="toggleRaw" class="chip" style="padding:6px 10px">원문 보기/수정</button>
      </div>
      <textarea id="raw" class="raw-area" spellcheck="false"></textarea>

      <div class="grid" id="resultGrid" style="display:none">
        <div class="card" id="cardA">
          <h3>1~3종 수술비</h3>
          <div class="tier" id="a1"><h4>1종</h4><ul class="list"></ul></div>
          <div class="tier" id="a2"><h4>2종</h4><ul class="list"></ul></div>
          <div class="tier" id="a3"><h4>3종</h4><ul class="list"></ul></div>
        </div>
        <div class="card" id="cardB">
          <h3>1~5종 수술비</h3>
          <div class="tier" id="b1"><h4>1종</h4><ul class="list"></ul></div>
          <div class="tier" id="b2"><h4>2종</h4><ul class="list"></ul></div>
          <div class="tier" id="b3"><h4>3종</h4><ul class="list"></ul></div>
          <div class="tier" id="b4"><h4>4종</h4><ul class="list"></ul></div>
          <div class="tier" id="b5"><h4>5종</h4><ul class="list"></ul></div>
        </div>
      </div>

      <div id="emptyState" class="empty">검색어를 입력하세요.</div>
    </section>
  </main>

  <script>
    // 설정: 설명(괄호) 표시 여부
    const SHOW_DESC = true;       // false로 변경하면 설명 숨김
    const MAX_PER_TIER = 200;     // 각 종별 최대 표시 개수

    // 원문 데이터 (줄바꿈 포함 그대로 교체 가능)
    const RAW_DATA = String.raw`
12(내시경적) 위용종제거술
12(내시경적) 위출혈지혈술
11andrew method
11bassini repair
11halsted's operation
21IVS 수술
11Lichtenstein tension free hernioplasty
11lucas championniere's op.
11marcy's simple ringclosure
11mcvay repair
21MMK 수술
11shouldice hernioplasty
11TAPP laparoscopic hernia  repair
23Y-자 인공혈관 우회술
35Y-자 인공혈관 우회술
12가관절수술
12각막 궤양 냉동응고술
X1각막 봉합술
X1각막 봉합술
XX각막 성형술
XX각막 수술(굴절이상교정술)
12각막 이식술
1X각막 절개술 및 절제술
12각막 종양 냉동응고술
... (생략 가능: 기존 전체 목록을 그대로 이어 붙이세요)
    `.trim();

    // DOM
    const elQ = document.getElementById('q');
    const elBtn = document.getElementById('searchBtn');
    const elAC = document.getElementById('ac');
    const elACList = document.getElementById('acList');
    const elRaw = document.getElementById('raw');
    const elToggleRaw = document.getElementById('toggleRaw');
    const elGrid = document.getElementById('resultGrid');
    const elEmpty = document.getElementById('emptyState');

    const elA = {1: document.querySelector('#a1 ul'), 2: document.querySelector('#a2 ul'), 3: document.querySelector('#a3 ul')};
    const elB = {1: document.querySelector('#b1 ul'), 2: document.querySelector('#b2 ul'), 3: document.querySelector('#b3 ul'), 4: document.querySelector('#b4 ul'), 5: document.querySelector('#b5 ul')};

    // utils
    function normalizeSpaces(s){ return s.replace(/\s+/g,' ').trim(); }

    function parseRaw(text){
      const out = [];
      const seen = new Set();
      const lines = text.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
      const re = /^\s*([0-9X])([0-9X])\s*(?:\(([^)]+)\))?\s*(.+?)\s*$/;
      for(const line of lines){
        const m = line.match(re);
        if(!m) continue;
        const aKey = m[1]; // 앞자리(3종)
        const bKey = m[2]; // 뒷자리(5종)
        const desc = m[3] ? normalizeSpaces(m[3]) : '';
        const name = normalizeSpaces(m[4]);
        const aTier = (aKey>='1' && aKey<='3') ? Number(aKey) : null;
        const bTier = (bKey>='1' && bKey<='5') ? Number(bKey) : null;
        const id = `${name}||${desc}||${aTier??'NA'}||${bTier??'NA'}`;
        if(seen.has(id)) continue;
        seen.add(id);
        out.push({ name, desc, aTier, bTier });
      }
      return out;
    }

    // 초기 세팅
    elRaw.value = RAW_DATA;
    let DB = parseRaw(elRaw.value);

    function suggest(q){
      const key = q.replace(/\s+/g,'');
      if(!key) return [];
      const seen = new Set();
      const out = [];
      for(const r of DB){
        const nkey = r.name.replace(/\s+/g,'');
        if(nkey.includes(key) && !seen.has(nkey)){
          out.push(r.name); seen.add(nkey);
          if(out.length>=12) break;
        }
      }
      return out;
    }
    function openAC(items){
      if(!items.length){ elAC.classList.remove('open'); return; }
      elACList.innerHTML = items.map((name,i)=> `<li data-i="${i}"><strong>${name}</strong> <span class="code">제안</span></li>`).join('');
      elAC.classList.add('open');
    }
    function closeAC(){ elAC.classList.remove('open'); }

    function liText(r){
      if(SHOW_DESC && r.desc) return `${r.name} <span class="muted">(${r.desc})</span>`;
      return r.name;
    }

    function renderGroups(rows){
      // 초기화
      for(let i=1;i<=3;i++) elA[i].innerHTML = '';
      for(let i=1;i<=5;i++) elB[i].innerHTML = '';

      // 그룹화
      const A = {1:[],2:[],3:[]};
      const B = {1:[],2:[],3:[],4:[],5:[]};

      for(const r of rows){
        if(r.aTier!=null && A[r.aTier]) A[r.aTier].push(r);
        if(r.bTier!=null && B[r.bTier]) B[r.bTier].push(r);
      }

      // 렌더 (각 종별 최대 MAX_PER_TIER개)
      for(let i=1;i<=3;i++){
        const items = A[i].slice(0, MAX_PER_TIER)
          .map(r=> `<li>${liText(r)}</li>`).join('');
        elA[i].innerHTML = items || `<li class="muted">해당 수술 없음</li>`;
      }
      for(let i=1;i<=5;i++){
        const items = B[i].slice(0, MAX_PER_TIER)
          .map(r=> `<li>${liText(r)}</li>`).join('');
        elB[i].innerHTML = items || `<li class="muted">해당 수술 없음</li>`;
      }
    }

    function doSearch(){
      const q = elQ.value.trim();
      if(!q){
        elGrid.style.display = 'none';
        elEmpty.style.display = 'block';
        return;
      }
      const key = q.replace(/\s+/g,'');
      const rows = DB.filter(r=> r.name.replace(/\s+/g,'').includes(key));
      renderGroups(rows);
      elEmpty.style.display = 'none';
      elGrid.style.display = 'grid';
      closeAC();
    }

    // 이벤트
    elQ.addEventListener('input', ()=>{ openAC(suggest(elQ.value)); });
    elQ.addEventListener('focus', ()=>{ openAC(suggest(elQ.value)); });
    elQ.addEventListener('blur', ()=>{ setTimeout(closeAC,150); });
    elACList.addEventListener('click', (e)=>{
      const li = e.target.closest('li'); if(!li) return;
      const idx = Number(li.dataset.i);
      const items = suggest(elQ.value);
      const name = items[idx];
      if(name){ elQ.value = name; doSearch(); }
    });

    document.querySelectorAll('.chip').forEach(ch=> ch.addEventListener('click', ()=>{
      elQ.value = ch.dataset.k; doSearch();
    }));
    elBtn.addEventListener('click', doSearch);
    elQ.addEventListener('keydown', (e)=>{ if(e.key==='Enter') doSearch(); });

    // 원문 보기/수정 토글
    elToggleRaw.addEventListener('click', ()=>{
      elRaw.classList.toggle('show');
    });

    // 원문 변경 시 재파싱
    elRaw.addEventListener('input', ()=>{
      DB = parseRaw(elRaw.value);
      if(elQ.value.trim()) doSearch();
    });
  </script>
</body>
</html>
