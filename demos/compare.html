<!DOCTYPE html>
<html lang="ko" data-mode="light" data-theme="indigo">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>극적 비교 데모 | CDN vs @apply (테마·다크모드·유지보수)</title>

  <!-- Tailwind Play CDN: 이 데모에서만 @apply 런타임 컴파일 허용 -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- @apply는 이 블록 안에서만 동작 -->
  <style type="text/tailwindcss">
    @layer components {
      /* ===== 공통 컴포넌트 (@apply) ===== */
      .btn { @apply inline-flex items-center justify-center rounded-lg px-3.5 py-2.5 text-sm font-semibold border shadow-sm transition; }
      .btn-ghost { @apply border-slate-200 bg-white hover:bg-white/80; }
      .btn-primary { @apply border-indigo-600 bg-indigo-600 text-white hover:opacity-90; }
      .btn-pdf { @apply border-sky-600 bg-sky-600 text-white hover:opacity-90; }

      .table { @apply overflow-hidden rounded-2xl border border-slate-200; }
      .row { @apply grid items-center gap-4 px-5 py-3 odd:bg-white even:bg-slate-50 hover:bg-white border-t border-slate-200; grid-template-columns:minmax(220px,1.2fr) 3fr; }
      .brand { @apply flex items-center gap-3; }
      .logo { @apply w-12 h-12 rounded-xl border border-slate-200 bg-white flex items-center justify-center overflow-hidden; }
      .name { @apply text-lg md:text-xl font-extrabold text-slate-900; }

      .calc-card { @apply rounded-3xl border border-indigo-200 bg-white shadow-sm; }
      .display { @apply rounded-2xl border border-slate-200 bg-white p-4 grid gap-1; }
      .display-num { @apply text-3xl font-black tracking-wider; font-variant-numeric: tabular-nums; }
      .key { @apply rounded-xl border py-2 px-4 text-sm font-semibold bg-white hover:bg-slate-50 border-slate-200; }
      .key-primary { @apply border-indigo-600 bg-indigo-600 text-white hover:opacity-90; }

      /* ======= 테마 토큰 (오른쪽 패널)에 일괄 적용: data-theme / data-mode ======= */
      /* 테마 팔레트: indigo / emerald / fuchsia */
      [data-theme="indigo"] .btn-primary { @apply border-indigo-600 bg-indigo-600; }
      [data-theme="indigo"] .calc-card { @apply border-indigo-200; }

      [data-theme="emerald"] .btn-primary { @apply border-emerald-600 bg-emerald-600; }
      [data-theme="emerald"] .calc-card { @apply border-emerald-200; }

      [data-theme="fuchsia"] .btn-primary { @apply border-fuchsia-600 bg-fuchsia-600; }
      [data-theme="fuchsia"] .calc-card { @apply border-fuchsia-200; }

      /* 다크모드 토큰: data-mode="dark" 인 경우 */
      [data-mode="dark"] body { @apply bg-slate-900 text-slate-100; }
      [data-mode="dark"] .table { @apply border-slate-700; }
      [data-mode="dark"] .row { @apply border-slate-700; }
      [data-mode="dark"] .row.odd\:bg-white { @apply bg-slate-800; }
      [data-mode="dark"] .row.even\:bg-slate-50 { @apply bg-slate-800/70; }
      [data-mode="dark"] .btn-ghost { @apply border-slate-700 bg-slate-800 hover:bg-slate-700; }
      [data-mode="dark"] .btn-pdf { @apply border-sky-500 bg-sky-500 text-white; }
      [data-mode="dark"] .display { @apply border-slate-700 bg-slate-800; }
      [data-mode="dark"] .calc-card { @apply bg-slate-900 border-slate-700; }
      [data-mode="dark"] .name { @apply text-slate-100; }
    }
  </style>

  <style>
    body{background:linear-gradient(180deg,#f8fafc 0%,#eef2f7 100%)}
    [data-mode="dark"] body{background:linear-gradient(180deg,#0b1220 0%,#0a1020 100%)}
  </style>
</head>
<body class="text-slate-900">
  <div class="max-w-6xl mx-auto px-5 py-8">
    <h1 class="text-3xl font-black">극적 비교: CDN vs <code>@apply</code></h1>
    <p class="text-slate-600 mt-1">좌측은 **CDN 방식**(테마/모드 변경 시 <u>모든 요소 클래스 교체</u>), 우측은 **@apply 방식**(상위 <code>data-theme</code>/<code>data-mode</code>만 바꿔 <u>전체 일괄 적용</u>).</p>

    <!-- 글로벌 컨트롤러 -->
    <div class="mt-4 rounded-xl border border-slate-200 bg-white p-3 flex flex-wrap items-center gap-2">
      <span class="text-sm font-semibold mr-2">테마:</span>
      <button class="theme-btn rounded-lg px-3 py-1.5 text-sm border border-slate-200 bg-white hover:bg-slate-50" data-theme="indigo">Indigo</button>
      <button class="theme-btn rounded-lg px-3 py-1.5 text-sm border border-slate-200 bg-white hover:bg-slate-50" data-theme="emerald">Emerald</button>
      <button class="theme-btn rounded-lg px-3 py-1.5 text-sm border border-slate-200 bg-white hover:bg-slate-50" data-theme="fuchsia">Fuchsia</button>
      <span class="w-px h-6 bg-slate-200 mx-2"></span>
      <span class="text-sm font-semibold">모드:</span>
      <button class="mode-btn rounded-lg px-3 py-1.5 text-sm border border-slate-200 bg-white hover:bg-slate-50" data-mode="light">라이트</button>
      <button class="mode-btn rounded-lg px-3 py-1.5 text-sm border border-slate-200 bg-white hover:bg-slate-50" data-mode="dark">다크</button>

      <span class="ml-auto text-xs text-slate-500">클래스 교체 수 — 좌: <b id="opsLeft">0</b>회 · 우: <b id="opsRight">0</b>회</span>
    </div>

    <div class="grid md:grid-cols-2 gap-6 mt-6">
      <!-- ================= LEFT: CDN RAW ================= -->
      <section id="cdnPanel" class="rounded-2xl border border-slate-200 bg-white/80 p-5">
        <h2 class="text-xl font-bold mb-3">A) CDN (유틸 직접 나열)</h2>

        <h3 class="text-sm font-semibold text-slate-600 mb-2">표 리스트</h3>
        <div class="overflow-hidden rounded-2xl border border-slate-200" id="cdnTable">
          <!-- row template function으로 채움 -->
        </div>

        <h3 class="text-sm font-semibold text-slate-600 mt-6 mb-2">보험나이 계산기</h3>
        <div class="max-w-[520px]">
          <div id="cdnCalc" class="rounded-3xl border border-indigo-200 bg-white shadow-sm">
            <div class="flex items-center justify-between p-4 border-b border-indigo-200/60">
              <div class="text-base font-bold">나이 계산기</div>
              <div class="text-[11px] px-2 py-0.5 rounded-full border border-indigo-200 bg-white" id="badgeA">–</div>
            </div>
            <div class="p-4 grid gap-3">
              <div class="rounded-2xl border border-slate-200 bg-white p-4 grid gap-1">
                <div class="text-[11px] text-slate-600 flex items-center justify-between"><span>보험나이</span><span>기준: 오늘</span></div>
                <div class="text-3xl font-black tracking-wider"><span id="numA">--</span><span class="text-xl align-top ml-1">세</span></div>
                <div class="text-xs text-slate-600" id="ruleA">생년월일을 입력하세요</div>
              </div>
              <form id="formA" class="grid gap-2 md:grid-cols-[1fr_auto_auto] items-end">
                <div>
                  <label class="text-sm font-medium">생년월일</label>
                  <input id="dobA" type="date" class="mt-1 w-full border border-slate-300 rounded-xl px-4 py-2.5" required />
                </div>
                <button class="rounded-xl border border-indigo-600 bg-indigo-600 text-white py-2 px-4 font-semibold hover:opacity-90" type="submit">계산하기</button>
                <button class="rounded-xl border border-slate-200 bg-white py-2 px-4 font-semibold hover:bg-slate-50" type="button" id="resetA">초기화</button>
              </form>
            </div>
          </div>
        </div>

        <p class="text-xs text-slate-500 mt-3">테마/모드 변경 시, 이 패널은 **모든 버튼/박스의 클래스 문자열을 직접 교체**합니다.</p>
      </section>

      <!-- ================= RIGHT: @apply ================= -->
      <section id="applyPanel" class="rounded-2xl border border-slate-200 bg-white/80 p-5">
        <h2 class="text-xl font-bold mb-3">B) @apply (컴포넌트 + 토큰)</h2>

        <h3 class="text-sm font-semibold text-slate-600 mb-2">표 리스트</h3>
        <div class="table" id="applyTable">
          <!-- row template function으로 채움 -->
        </div>

        <h3 class="text-sm font-semibold text-slate-600 mt-6 mb-2">보험나이 계산기</h3>
        <div class="max-w-[520px]">
          <div class="calc-card" id="applyCalc">
            <div class="flex items-center justify-between p-4 border-b border-indigo-200/60">
              <div class="text-base font-bold">나이 계산기</div>
              <div class="text-[11px] px-2 py-0.5 rounded-full border border-indigo-200 bg-white" id="badgeB">–</div>
            </div>
            <div class="p-4 grid gap-3">
              <div class="display">
                <div class="text-[11px] text-slate-600 flex items-center justify-between"><span>보험나이</span><span>기준: 오늘</span></div>
                <div class="display-num"><span id="numB">--</span><span class="text-xl align-top ml-1">세</span></div>
                <div class="text-xs text-slate-600" id="ruleB">생년월일을 입력하세요</div>
              </div>
              <form id="formB" class="grid gap-2 md:grid-cols-[1fr_auto_auto] items-end">
                <div>
                  <label class="text-sm font-medium">생년월일</label>
                  <input id="dobB" type="date" class="mt-1 w-full border border-slate-300 rounded-xl px-4 py-2.5" required />
                </div>
                <button class="key key-primary" type="submit">계산하기</button>
                <button class="key" type="button" id="resetB">초기화</button>
              </form>
            </div>
          </div>
        </div>

        <p class="text-xs text-slate-500 mt-3">테마/모드 변경 시, 이 패널은 **상위의 <code>data-theme</code>/<code>data-mode</code>만 바꿉니다**(클래스 교체 없음).</p>
      </section>
    </div>

    <p class="text-sm text-slate-600 mt-6">
      <strong>핵심:</strong> 좌측은 테마를 바꿀 때 **수십~수백 개 DOM 클래스 교체**가 일어나는 반면, 우측은 **상위 속성 1~2개만 변경**으로 전체 스타일이 바뀜.
      실제 운영에선 Play CDN 대신 GitHub Actions로 CSS를 빌드하여 <code>@apply</code> 기반 토큰 설계를 추천.
    </p>
  </div>

  <script>
    // ===== 표 데이터 (샘플) =====
    const rows = [
      { name: "삼성화재" }, { name: "현대해상" }, { name: "DB손해보험" }, { name: "KB손해보험" }, { name: "메리츠화재" }
    ];

    // ===== CDN 측 템플릿(긴 클래스) =====
    const cdnBtnPrimary = "inline-flex items-center justify-center rounded-lg px-3.5 py-2.5 text-sm font-semibold border text-white hover:opacity-90";
    const cdnBtnGhost   = "inline-flex items-center justify-center rounded-lg px-3.5 py-2.5 text-sm font-semibold border bg-white hover:bg-white/80";
    const cdnColors = {
      indigo:  { primary: "border-indigo-600 bg-indigo-600" , calcBorder: "border-indigo-200", calcHeader: "border-indigo-200/60" },
      emerald: { primary: "border-emerald-600 bg-emerald-600", calcBorder: "border-emerald-200", calcHeader: "border-emerald-200/60" },
      fuchsia: { primary: "border-fuchsia-600 bg-fuchsia-600", calcBorder: "border-fuchsia-200", calcHeader: "border-fuchsia-200/60" }
    };

    function cdnRowHTML(theme) {
      const c = cdnColors[theme] || cdnColors.indigo;
      return `
      <div class="grid items-center gap-4 px-5 py-3 odd:bg-white even:bg-slate-50 hover:bg-white border-t border-slate-200" style="grid-template-columns:minmax(220px,1.2fr) 3fr">
        <div class="flex items-center gap-3">
          <span class="w-12 h-12 rounded-xl border border-slate-200 bg-white flex items-center justify-center overflow-hidden">
            <img src="/assets/logos/placeholder.png" class="w-full h-full object-contain" onerror="this.style.display='none'">
          </span>
          <div class="text-lg md:text-xl font-extrabold text-slate-900">회사명</div>
        </div>
        <div class="grid gap-2 sm:grid-cols-5">
          <a class="${cdnBtnPrimary} ${c.primary}">전산 접속</a>
          <a class="${cdnBtnGhost}  border-slate-200">필요서류 안내</a>
          <a class="${cdnBtnPrimary} border-sky-600 bg-sky-600">보험금 청구서 PDF 다운로드</a>
          <a class="${cdnBtnGhost}  border-slate-200">고객센터</a>
          <a class="${cdnBtnGhost}  border-slate-200">모바일 청구</a>
        </div>
      </div>`;
    }

    function hydrateCDN(theme) {
      const table = document.getElementById('cdnTable');
      table.innerHTML = '';
      rows.forEach(r => { table.insertAdjacentHTML('beforeend', cdnRowHTML(theme).replace('회사명', r.name)); });
      // 계산기 보더 색 바꾸기
      const calc = document.getElementById('cdnCalc');
      const c = cdnColors[theme] || cdnColors.indigo;
      swapMany(calc, [
        ["border-(indigo|emerald|fuchsia)-200","border-"+theme+"-200"],
        ["border-(indigo|emerald|fuchsia)-200\\/60","border-"+theme+"-200/60"]
      ]);
    }

    // ===== @apply 측 템플릿(짧은 클래스) =====
    function applyRowHTML(r) {
      return `
        <div class="row">
          <div class="brand">
            <span class="logo"><img src="/assets/logos/placeholder.png" class="w-full h-full object-contain" onerror="this.style.display='none'"></span>
            <div class="name">${r.name}</div>
          </div>
          <div class="grid gap-2 sm:grid-cols-5">
            <a class="btn btn-primary">전산 접속</a>
            <a class="btn btn-ghost">필요서류 안내</a>
            <a class="btn btn-pdf">보험금 청구서 PDF 다운로드</a>
            <a class="btn btn-ghost">고객센터</a>
            <a class="btn btn-ghost">모바일 청구</a>
          </div>
        </div>`;
    }

    function hydrateApply() {
      const table = document.getElementById('applyTable');
      table.innerHTML = '<div class="table"></div>';
      table.className = 'table';
      const inner = rows.map(applyRowHTML).join('');
      table.innerHTML = inner;
    }

    // ===== 테마/모드 토글: 좌(클래스 치환 다수), 우(data-속성 1~2개) =====
    let opsLeft = 0, opsRight = 0;
    const opsLeftEl = document.getElementById('opsLeft');
    const opsRightEl = document.getElementById('opsRight');

    function swapMany(root, replacers) {
      // 좌측 CDN: 클래스 문자열 치환(치환 횟수 카운트)
      const all = root.querySelectorAll('*');
      all.forEach(el => {
        if (!el.className) return;
        let cls = el.className;
        replacers.forEach(([from,to]) => {
          const re = new RegExp(from, 'g');
          if (re.test(cls)) {
            const before = cls;
            cls = cls.replace(re, to);
            if (before !== cls) opsLeft++;
          }
        });
        el.className = cls;
      });
      opsLeftEl.textContent = opsLeft.toString();
    }

    function setTheme(theme) {
      // 좌: 모든 요소 클래스 치환
      hydrateCDN(theme); // 새로 그리고 색 반영(여기서 내부적으로 swapMany 사용)
      // 우: data-theme만 바꾸면 끝
      document.documentElement.setAttribute('data-theme', theme);
      opsRight++; opsRightEl.textContent = opsRight.toString();
    }

    function setMode(mode) {
      // 좌: 다크 모드일 때 배경/텍스트/보더들을 직접 치환(간단 버전)
      const root = document.getElementById('cdnPanel');
      if (mode === 'dark') {
        swapMany(root, [
          ["bg-white","bg-slate-900"], ["text-slate-900","text-slate-100"], ["text-slate-600","text-slate-300"],
          ["border-slate-200","border-slate-700"], ["bg-slate-50","bg-slate-800/70"]
        ]);
      } else {
        // 라이트로 복구는 데모 단순화를 위해 재렌더
        hydrateCDN(document.documentElement.getAttribute('data-theme') || 'indigo');
      }

      // 우: data-mode만 바꾸면 끝
      document.documentElement.setAttribute('data-mode', mode);
      opsRight++; opsRightEl.textContent = opsRight.toString();
    }

    // 초기 렌더
    hydrateCDN('indigo');
    hydrateApply();

    // 컨트롤 바인딩
    document.querySelectorAll('.theme-btn').forEach(b => b.addEventListener('click', () => setTheme(b.dataset.theme)));
    document.querySelectorAll('.mode-btn').forEach(b => b.addEventListener('click', () => setMode(b.dataset.mode)));

    // ====== 계산기 로직(양쪽 동일) ======
    const fmt = d => `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
    const addMonths = (d, m) => { const x = new Date(d); const day=x.getDate(); x.setMonth(x.getMonth()+m); if (x.getDate()!==day) x.setDate(0); return x; };
    function intlAge(dob, asof){ let a = asof.getFullYear()-dob.getFullYear(); const bThis = new Date(asof.getFullYear(), dob.getMonth(), dob.getDate()); if(asof < bThis) a -= 1; return a; }
    function insAge(dob, asof){ const base=intlAge(dob,asof); const lastYear = asof.getFullYear() - (asof < new Date(asof.getFullYear(), dob.getMonth(), dob.getDate()) ? 1 : 0); const last = new Date(lastYear, dob.getMonth(), dob.getDate()); const half=addMonths(last,6); const plus = asof >= half ? 1 : 0; return {base, ins: base+plus, half}; }

    function hookCalc(prefix){
      const form = document.getElementById('form'+prefix);
      const dob = document.getElementById('dob'+prefix);
      const num = document.getElementById('num'+prefix);
      const intl = document.getElementById('intl'+prefix);
      const rule = document.getElementById('rule'+prefix);
      const half = document.getElementById('half'+prefix);
      const badge = document.getElementById('badge'+prefix);

      if(!form) return;
      form.addEventListener('submit', e=>{
        e.preventDefault();
        if(!dob.value) return;
        const asof = new Date();
        const d = new Date(dob.value);
        const r = insAge(d, asof);
        num.textContent = r.ins;
        if (intl) intl.textContent = r.base;
        rule.textContent = (asof >= r.half) ? '오늘 기준: 최근 생일부터 6개월 경과 → +1' : '오늘 기준: 최근 생일부터 6개월 미만';
        const ms = r.half - asof;
        if (half) half.textContent = (ms<=0) ? '이미 전환됨' : `${fmt(r.half)} (약 ${Math.floor(ms/86400000)}일 ${Math.floor((ms%86400000)/3600000)}시간 남음)`;
        if (badge) badge.textContent = `${r.ins}세`;
      });
      const reset = document.getElementById('reset'+prefix);
      if (reset) reset.addEventListener('click', ()=>{ dob.value=''; num.textContent='--'; if(intl) intl.textContent='–'; rule.textContent='생년월일을 입력하세요'; if(half) half.textContent='–'; if(badge) badge.textContent='–'; });
    }
    hookCalc('A'); hookCalc('B');
  </script>
</body>
</html>
